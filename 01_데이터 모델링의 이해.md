# 01_데이터 모델링의 이해

## 1. 데이터 모델링의 이해

### 모델링의 특징

1. 현실세계를 일정한 형식에 맞추어 표현하는 추상화의 의미를 가질 수 있음

2. 복잡한 현실을 제한된 언어나 표기법을 통해 이해하기 쉽게 하는 단순화의 의미를 가지고 있음

3. 애매모호함을 배제하고 누구나 이해가 가능하도록 정확하게 현상을 기술하는 정확하의 의미를 가짐

### 데이터 모델링이란

1. 정보시스템을 구축하기 위한 데이터 관점의 업무 분석 기법

2. 현실세계의 데이터에 대해 약속된 표기법엥 의해 표현하는 과정

3. 데이터베이스를 구축하기 위한 분석/설계의 과정

### 데이터 모델링 유의점

1. 중복

2. 비유연성 

3. 비일관성

### 데이터 모델링 개념

- 개념적 데이터 모델링

    추상화 수준이 높고 업무중심적이고 포괄적인 수준의 모델링 진행.
    전사적 데이터 모델링, EA수립시 많이 이용

- 논리적 데이터 모델링

    시스템으로 구축하고자 하는 업무에 대해 Key, 속성, 관계 등을
    정확하게 표현, 재사용성이 높음

- 물리적 데이터 모델링

    실제로 데이터베이스에 이식할 수  있도록 성능, 저장 등 
    물리적인 성격을 고려하여 설계

### 데이터베이스 스키마 구조 3단계

- 외부스키마(External Schema)

- 개념스키마(Conceptual Schema)

    통합관점의 스키마구조를 표현 

- 내부스키마(Internal Schema)

### ERD 작성 순서

1. 엔터티를 그린다.

2. 엔터티를 적절하게 배치한다.

3. 엔터티간 관계를 설정한다.

4. 관계명을 기술한다.

5. 관계의 참여도를 기술한다.

6. 관계의 필수여부를 기술한다.

### 엔터티의 특징 

- 반드시 해당 업무에서 필요하고 관리하고자 하는 정보이어야 한다.

- 유이한 식별자에 의해 식별이 가능해야 한다.

- 영속적으로 존재하는 인스턴스의 집합이어야 한다.
  ('한 개'가 아니라 '두 개 이상')

- 엔터티는 업무 프로세스에 의해 이용되어야 한다.

- 엔터티는 반드시 속성이 있어야한다.

- 엔터티는 다른 엔터티와 최소 한 개 이상의 관계가 있어야 한다.
  (공통코드, 통계성 엔터티의 경우 관계를 생략할 수 있다.)

### 엔터티의 분류

- 기본 엔터티(키엔터티)

    - 다른 엔터티와의 관계에 의해 생성되지 않고 독립접으로 생성이 가능

    - 자신은 타 엔터티의 부모 역할을 한다.

    - 다른 엔터티로부터 주식별자를 상속받지 않고 자신의 고유한 주식별자를 가지게 된다.

    ex. 사원, 부서, 고객, 상품, 자재 등

- 중심 엔터티(메인엔터티)

- 행위 엔터티

- 개념 엔터티

### 엔터티의 이름 설정

1. 가능하면 현업업무에서 사용하는 용어를 사용한다.

2. 가능하면 약어를 사용하지 않는다.

3. 단수명사를 사용한다.

4. 모든 엔터티를 통틀어서 유일하게 이름이 부여되어야 한다.

5. 엔터티 생성의미대로 이름을 부여한다.

### 속성

- 업무에서 필요로 하는 인스턴스에서 관리하고자 하는 의미상 
  더 이상 분리되지 않는 최소의 데이터 단위

### 엔터티, 인스턴스, 속성, 속성값의 관계

- 한 개의 엔터티는 두 개 이상의 인스턴스의 집합이어야 한다.

- 한 개의 엔터티는 두 개 이상의 속성을 갖는다. 

- 한 개의 속성은 한 개의 속성값을 갖는다.

### 속성의 특성에 따른 분류

- 기본 속성

    ex. 원금, 예치기간, 이자율

- 설계 속성

    ex. 예금분류

- 파생 속성

    데이터를 조회할 때 빠른 성능을 할 수 있도록 하기 위해 
    원래 속성의 값을 계산하여 저장할 수 있도록 만든 속성

    ex. 이자

### 도메인

- 각 속성이 가질 수 있는 값의 범위

- 엔터티 내에서 속성에 대한 데이터타입과 크기 
  그리고 제약사항을 지정하는 것

### 식별자

- 대표성 여부

    - 주식별자

        엔터티 내에서 각 어커런스를 구분할 수 있는 구분자이며, 타 엔터티와 참조관계를 연결할 수 있는 식별자

    - 보조식별자

        엔터티 내에서 각 어커런스를 구분할 수 있는 구분자이나 대표성을 가지지 못해 참조관계 연결을 못함

- 스스로 생성여부

    - 내부식별자

        엔터티 내부에서 스스로 만들어지는 식별자

    - 외부식별자

        타 엔터티와의 관계를 통해 타 엔터티로부터 받아오는 식별자

- 속성의 수

    - 단일식별자

        하나의 속성으로 구성된 식별자

    - 복합식별자

        둘 이상의 속성으로 구성된 식별자

- 대체 여부

    - 본질식별자

        업무에 의해 만들어지는 식별자

    - 인조식별자

        업무적으로 만들어지지는 않지만 원조식별자가 복잡한 구성을 가지고 있기 때문에 인위적으로 만든 식별자

### 주식별자를 지정할 때 고려 할 사항

1. 주식별자에 의해 엔터티내에 모든 인스턴스들이 유일하게 구분되어야 한다.

2. 주식별자를 구성하는 속성의 수는 유일성을 만족하는 최소의 수가 되어야 한다.

3. 지정된 주식별자의 값은 자주 변하지 않는 것이어야 한다.

4. 주식별자가 지정이 되면 반드시 값이 들어와야 한다.

### 주식별자의 특징

- 유일성 : 주식별자에 의해 엔터티내에 모든 인스턴스들을 유일하게 구분함

- 최소성 : 주식별자를 구성하는 속성의 수는 유일성을 만족하는 최소의 수가 되어야 함

- 불변성 : 주식별자가 한 번 특정 엔터티에 지정되면 그 식별자의 값은 변하지 않아야 함

- 존재성 : 주식별자가 지정되면 반드시 데이터 값이 존재 (Null 안됨)

### 식별자와 비식별자관계 비교

|항목|식별자관계|비식별자관계|
|:---:|---|---|
|목적|강한 연결관계 표현|약한 연결관계 표현|
|자식 주식별자 영향|자식 주식별자의 구성에 포함됨|자식 일반 속성에 포함됨|
|표기법|실선 표현|점선 표현|
|연결 고려사항|- 반드시 부모엔터티 종속 <br> - 자식 주식별자구성에 부모 주식별자포함 필요 <br> - 상속받은 주식별자속성을 타엔터티에 이전 필요|- 약한 종속관계 <br> - 자식 주식별자구성을 독립적으로 구성 <br> - 자식 주식별자구성에 부모 주식별자 부분 필요 <br> - 상속받은 주식별자속성을 타 엔터티에 차단 필요 <br> - 부모쪽의 관계참여가 선택관계| 



## 2. 데이터 모델과 성능

### 성능데이터모델링

데이터베이스 성능 향상을 목적으로 설계단계의 데이터 몰델링 때부터 성능과 관련된
사항이 데이터 모델링에 반영될 수 있도록 하는 것이다.

### 성능 데이터 모델링 수행 절차

1. 데이터모델링을 할 때 정규화를 정확하게 수행한다.

2. 데이터베이스 용량산정을 수행한다.

3. 데이터베이스에 발생되는 트랜잭션의 유형을 파악한다.

    - 트랜잭션 : 쪼갤 수 없는 업무 처리의 최소 단위

4. 용량과 트랜잭션의 유형에 따라 반정규화(역정규화)를 수행한다.

5. 이력모델의 조정, PK/FK조정, 슈퍼타입/서브타입 조정 등을 수행한다.

    - 슈퍼타입 : 공통의 부분

    - 서브타입 : 공통으로부터 상속받아서

6. 성능관점에서 데이터모델을 검증한다.

### 정규화

데이터베이스의 설계를 재구성하는 테크닉

- 불필요한 데이터 제거

- 삽입/갱신/삭제 시 발생할 수 있는 각종 이상현상들을 방지

- "논리적"으로 데이터를 저장 - 데이터 테이블의 구성이 논리적이고 직관적

#### 1차 정규화

테이블의 컬럼이 원자값(하나의 값)을 갖도록 테이블을 분해하는 것

|이름|나이|좋아하는 음식|
|---|---|---|
|장영|25|떡볶이, 쌀국수|
|이진|25|돈까스|
|주혜|24|소고기|
|정희|24|치킨|

🔻

|이름|나이|좋아하는 음식|
|---|---|---|
|장영|25|떡볶이|
|장영|25|쌀국수|
|이진|25|돈까스|
|주혜|24|소고기|
|정희|24|치킨|

#### 2차 정규화

1차 정규화를 진행한 테이블에 대해 완전 함수 종속을 만족하도록 테이블을 분해하는것

- 완전 함수 종속 : 기본키의 부분집합이 결정자가 되어선 안된다는 것

|이름|좋아하는 음식|
|---|---|
|장영|떡볶이|
|장영|쌀국수|
|이진|돈까스|
|주혜|소고기|
|정희|치킨|

|이름|나이|
|---|---|
|장영|25|
|장영|25|
|이진|25|
|주혜|24|
|정희|24|

#### 3차 정규화

2차 정규화를 진행한 테이블에 대해 이행적 종속을 없애도록 테이블을 분해 하는 것

이행적 종속 : A -> B, B -> C가 성립할 때 A -> C가 성립되는 것을 의미

|이름|나이|도시|Zip code|
|---|---|---|---|
|장영|25|제주|01234|
|장영|25|제주|01234|
|이진|25|서울|56789|
|주혜|24|부산|13579|
|정희|24|강릉|24681|

🔻

|이름|나이|
|---|---|
|장영|25|
|장영|25|
|이진|25|
|주혜|24|
|정희|24|

|Zip code|도시|
|---|---|
|01234|제주|
|01234|제주|
|56789|서울|
|13579|부산|
|24681|강릉|

#### BCNF (Boyce-Codd Normal Form)

3차 정규화를 진행한 테이블에 대해 모든 결정자가 후보키가 되어 테이블을 분해하는 것

|이름|과목|교수님|학점|
|---|---|---|---|
|장영|말과승마|Dr.김|A|
|장영|데이터베이스|Dr.윤|B|
|이진|운영체제|Dr.임|B+|
|주혜|모바일프로그래밍|Dr.최|A+|
|정희|사물인터넷|Dr.고|C+|

🔻

|이름|과목|학점|
|---|---|---|
|장영|말과승마|A|
|장영|데이터베이스|B|
|이진|운영체제|B+|
|주혜|모바일프로그래밍|A+|
|정희|사물인터넷|C+|

|교수님|과목|
|Dr.김|말과승마|
|Dr.윤|데이터베이스|
|Dr.임|운영체제|
|Dr.최|모바일프로그래밍|
|Dr.고|사물인터넷|

### 반정규화

- 정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상과 개발과 운영의 단순화를 위해
    중복, 통합, 분리 등을 수행하는 데이터 모델링의 기법

- 데이터를 중복하여 성능을 향상시키기 위한 기법

- 반정규화를 적용하는 이유

    - 데이터를 조회할 때 디스크 I/O량이 많아서 성능이 저하되거나 경로가 너무 멀어 조인으로
        인한 성능저하가 예상되거나 칼럼을 계산하여 읽을 때 성능이 저하될 것이 예상되는 경우

### 반정규화 절차

1. 반정규화 대상조사

    - 범위처리빈도수 조사

    - 대량의 범위 처리 조사

    - 통계성 프로세스 조사

    - 테이블 조인 개수

2. 다른 방법유도 검토

    - 뷰(VIEW) 테이블

    - 클러스터링 적용

    - 인덱스의 적용

    - 응용애플리케이션

3. 반정규화 적용

    - 테이블 반정규화

    - 속성의 반정규화

    - 관계의 반정규화

### 반정규화의 대상에 대해 다른 방법으로 처리하는 법

- 지나치게 많은 조인이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우
    뷰(VIEW)를 사용하면 이를 해결할 수도 있다.

- 대량의 데이터처리나 부분처리에 의해 성능이 저하되는 경우에 클러스터링을 적용하거나 
    인덱스를 조정함으로써 성능을 향상시킬 수 있다.

- 대량의 데이터는 Primary Key의 성격에 따라 부분적인 테이블로 분리할 수 있다.
    즉 파티셔닝 기법(Partitioning)이 적용되어 성능저하를 방지할 수 있다.

- 응용 애플리케이션에서 로직을 구사하는 방법을 변경함으로써
    성능을 향상시킬 수 있다.

### 슈퍼/서브 타입 데이터 모델의 변환기술

- 개별로 발생되는 트랜잭션에 대해서는 개별 테이블로 구성

- 슈퍼타입 + 서브타입에 대해 발생되는 트랜잭션에 대해서는 슈퍼타입+서브타입 테이블로 구성

- 전체를 하나로 묶어 트랜잭션이 발생할 때는 하나의 테이블로 구성

### PK순서를 결정하는 기준

- 인덱스 정렬구조를 이해한 상태에서 인덱스를 효율적으로 이용할 수 있도록 PK순서를 지정해야 한다.

- 인덱스의 특징은 여러개의 속성이 하나의 인덱스로 구성되어 있을때 앞쪽에 위치한 속성의 값이 
    비교자로 있어야 좋은 효율을 낼 수 있다.

- 앞쪽에 위치한 속성 값이 가급적 '=' or 범위 'between', '<>'이 들어와야 인덱스를 효율적으로 이용할 수 있다

### 분산데이터베이스

- 장점

    - 지역 자치성, 점증적 시스템 용량 확장

    - 신뢰성과 가용성

    - 효용성과 융통성

    - 빠른 응답 속도와 통신비용 절감

    - 데이터의 가용성과 신뢰성 증가

    - 시스템 규모의 적절한 조절

    - 각 지역 사용자의 요구 수용 증대

- 단점

    - 소프트웨어 개발 비용

    - 오류의 잠재성 증대

    - 처리 비용의 증대

    - 설계, 관리의 복잡성과 비용

    - 불규칙한 응답 속도

    - 통제의 어려움

    - 데이터 무결성에 대한 위협